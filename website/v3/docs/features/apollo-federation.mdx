---
id: apollo-federation
title: Apollo Federation with GraphQL Yoga
sidebar_label: Apollo Federation
---

[Apollo Federation is a specification that applies microservice architecture through GraphQL APIs.](https://www.apollographql.com/docs/federation/)

Thanks to [Envelop's Apollo Federation](https://www.envelop.dev/plugins/use-apollo-federation) plugin, we can use GraphQL Yoga to build our gateway server.

> As documented in the [Apollo Federation docs](https://www.apollographql.com/docs/federation/gateway/#setup), `@apollo/gateway` package doesn't support GraphQL v16 so you have to install `graphql@15`
> Please note that Apollo Federation implementation doesn't support GraphQL Subscriptions. If you need to use Subscriptions with a Federated Gateway you can use [Schema Stitching](https://www.graphql-tools.com/docs/schema-stitching/stitch-federation)

## Gateway

### Installation for Gateway

<PackageInstall
  packages={[
    'graphql-yoga',
    '@apollo/gateway',
    '@envelop/apollo-federation',
    'graphql@15',
  ]}
/>

### Example Gateway

```ts
import { createYoga } from 'graphql-yoga'
import { createServer } from 'http'
import { ApolloGateway } from '@apollo/gateway'
import { useApolloFederation } from '@envelop/apollo-federation'

// Initialize the gateway
const gateway = new ApolloGateway({
  serviceList: [
    { name: 'accounts', url: 'http://localhost:4001' },
    { name: 'products', url: 'http://localhost:4002' },
    // ...additional subgraphs...
  ],
})

// Make sure all services are loaded
await gateway.load()

const yoga = createYoga({
  plugins: [
    useApolloFederation({
      gateway,
    }),
  ],
})

// Start the server and explore http://localhost:4000/graphql
const server = createServer(yoga)
server.listen(4000)
```

## Federation Service

You don't need any extra plugins for Yoga for Federation Service.

### Installation

<PackageInstall packages={['graphql-yoga', '@apollo/subgraph', 'graphql']} />

### Example User Service

```ts
const { parse } = require('graphql')
const { buildSubgraphSchema } = require('@apollo/subgraph')
const { createYoga } = require('graphql-yoga')
const { createServer } = require('http')

const typeDefs = parse(/* GraphQL */ `
  type Query {
    me: User
  }

  type User @key(fields: "id") {
    id: ID!
    username: String
  }
`)

const resolvers = {
  Query: {
    me() {
      return { id: '1', username: '@ava' }
    },
  },
  User: {
    __resolveReference(user, { fetchUserById }) {
      return fetchUserById(user.id)
    },
  },
}
const yoga = createYoga({
  schema: buildSubgraphSchema([{ typeDefs, resolvers }]),
})

const server = createServer(yoga)

server.listen(4001, () => {
  console.log(`ðŸš€ Server ready at http://localhost:4001`)
})
```

## Working Example

Check our [working example](https://github.com/dotansimha/graphql-yoga/tree/master/examples/apollo-federation) to try it out.
